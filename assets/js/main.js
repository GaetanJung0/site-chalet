const translations = {
  fr: {
    'page.title': "Hameau retrouv√© - Chalet √† Les Carroz d'Ar√¢ches",
    'meta.description': "Louez le chalet Hameau Retrouv√© aux Carroz d'Ar√¢ches. 3 chambres, 8 personnes, au c≈ìur du Grand Massif. R√©servez votre s√©jour √† la montagne.",
    'brand.name': 'HAMEAU RETROUV√â',
    'nav.home': 'Accueil',
    'nav.location': 'Localisation',
    'nav.activities': 'Activit√©s',
    'nav.book': 'R√©server',
    'language.switchLabel': 'Choix de langue',
    'hero.tag': "Les Carroz d'Ar√¢ches",
    'hero.title': 'Votre chalet Hameau Retrouv√©',
    'hero.subtitle': 'Un cocon chaleureux pour r√©unir famille et amis, √† deux pas des pistes et des commerces.',
    'hero.cta': 'Voir le chalet',
    'intro.label': 'Hameau Retrouv√©',
    'intro.title': 'Votre refuge alpin priv√©',
    'intro.paragraph1': "Le niveau sup√©rieur concentre un s√©jour-cuisine de 29 m¬≤ sous charpente, √©quip√© d'un po√™le √† granul√©s r√©cent et ouvert sur deux balcons orient√©s sud.",
    'intro.paragraph2': 'Le chalet d√©veloppe 80 m¬≤ habitables sur trois niveaux, avec terrasse de 10 m¬≤, jardin clos et vues d√©gag√©es sur les sommets du Grand Massif.',
    'intro.paragraph3': "L'√©tage interm√©diaire comprend une chambre double, une chambre twin et une salle de bain avec WC. Le rez-de-jardin regroupe une deuxi√®me chambre double avec acc√®s ext√©rieur, un canap√© convertible, une salle de bain additionnelle et un WC ind√©pendant.",
    'stats.bedrooms': 'Chambres',
    'stats.guests': 'Personnes',
    'stats.bathrooms': 'Salles de bain',
    'gallery.title': 'Gallerie photo',
    'gallery.labels.living': 'Salon',
    'gallery.labels.bedroom': 'Chambre',
    'gallery.labels.kitchen': 'Cuisine',
    'gallery.labels.dining': 'Salle √† manger',
    'gallery.labels.view': 'Vue montagne',
    'gallery.labels.stove': 'Po√™le √† granul√©s',
    'gallery.labels.lounge': 'Espace d√©tente',
    'gallery.labels.bedroom2': 'Chambre 2',
    'gallery.labels.panorama': 'Panorama',
    'practical.card1.title': 'Emplacement id√©al',
    'practical.card1.text': 'Boulangerie artisanale, navette Grand Massif et location de mat√©riel au pied du chalet ‚Ä¢ Super U √† 10 min en voiture ‚Ä¢ Centre station √† 1,4 km',
    'practical.card2.title': 'Pour les skieurs',
    'practical.card2.text': 'Domaine Grand Massif ‚Ä¢ Local √† ski privatif ‚Ä¢ Navette gratuite pour la t√©l√©cabine',
    'practical.card3.title': 'Tout inclus',
    'practical.card3.text': "Draps & serviettes ‚Ä¢ Lits faits √† l'arriv√©e ‚Ä¢ Kit b√©b√© ‚Ä¢ Deux places de parking",
    'features.title': '√âquipements & Services',
    'features.subtitle': 'Des espaces pens√©s pour vivre des moments m√©morables, hiver comme √©t√©.',
    'features.sleep.title': 'Confort nuit & bains',
    'features.sleep.desc': '3 chambres calmes, 2 salles de bain.',
    'features.sleep.list': [
      '<li>Chambre double avec rangements au niveau interm√©diaire</li>',
      '<li>Chambre twin (2 lits simples) id√©ale pour enfants ou amis</li>',
      '<li>Suite rez-de-jardin : chambre double + canap√© convertible</li>',
      '<li>2 salles de bain avec baignoire + 2 WC dont 1 ind√©pendant</li>',
      "<li>Linge fourni et lits faits √† l'arriv√©e</li>",
      '<li>Kit b√©b√© disponible (lit parapluie, chaise haute)</li>'
    ].join(''),
    'features.dining.title': 'Moments gourmands',
    'features.dining.desc': 'Cuisine √©quip√©e comme √† la maison pour vos festins savoyards.',
    'features.dining.list': [
      '<li>S√©jour de 29 m¬≤ au dernier niveau</li>',
      '<li>Po√™le √† granul√©s r√©cent et ambiance bois chaleureuse</li>',
      '<li>Cuisine am√©nag√©e : four, plaques, micro-ondes, lave-vaisselle</li>',
      '<li>Deux balcons plein sud + terrasse et jardin de 10 m¬≤</li>',
      '<li>Appareils √† fondue/raclette et vaisselle pour 8 convives</li>'
    ].join(''),
    'features.ski.title': 'Ski & outdoor',
    'features.ski.desc': 'Tout est pr√™t pour vos journ√©es sur les pistes.',
    'features.ski.list': [
      '<li>Local √† ski privatif chauff√© et s√©curis√©</li>',
      '<li>Deux places de parking ext√©rieures d√©di√©es</li>',
      '<li>Navette gratuite vers la t√©l√©cabine juste en bas de la route</li>',
      "<li>Jardin clos pour les jeux d'hiver et les pique-niques</li>",
      '<li>Acc√®s direct au domaine du Grand Massif (265 km de pistes)</li>'
    ].join(''),
    'features.services.title': 'Services inclus',
    'features.services.desc': 'On s‚Äôoccupe des d√©tails, vous profitez.',
    'features.services.list': [
      "<li>Lits faits, linge de maison complet et produits d'accueil</li>",
      '<li>Chauffage mixte : po√™le √† granul√©s + radiateurs √©lectriques</li>',
      '<li>Chauffe-eau √©lectrique et VMC simple flux pour un confort constant</li>',
      '<li>Cave/local pratique pour skis, luges ou v√©los</li>',
      '<li>Maison lou√©e avec tout le n√©cessaire du quotidien</li>'
    ].join(''),
    'booking.title': "Pr√™t √† vivre l'exp√©rience ?",
    'booking.subtitle': 'Consultez nos tarifs en direct et r√©servez en deux minutes.',
    'booking.primary': 'R√©server sur Airbnb',
    'booking.secondary': 'Poser une question',
    'reviews.title': 'Ce que nos voyageurs adorent',
    'reviews.item1.text': '"Chalet splendide, tr√®s propre et super bien plac√©. La boulangerie juste en bas est un vrai plus pour les petits-d√©jeuners. Nous reviendrons !"',
    'reviews.item1.author': 'Ginette',
    'reviews.item2.text': '"On se sent comme chez soi. Confort, d√©co chaleureuse, √©quipements complets. Le local √† ski chauff√© est top apr√®s une journ√©e sur les pistes."',
    'reviews.item2.author': 'Jo√´lle',
    'reviews.item3.text': '"Parfait pour une tribu ! Cuisine tr√®s bien √©quip√©e pour les soir√©es raclette, po√™le √† granul√©s cosy et h√¥tes ultra r√©actifs."',
    'reviews.item3.author': 'Sylvie',
    'location.title': "Les Carroz d'Ar√¢ches",
    'location.lead': 'Station-village authentique, reli√©e au Grand Massif et accessible en 1h depuis Gen√®ve.',
    'location.items.bakery.title': 'Boulangerie artisanale',
    'location.items.bakery.text': '<strong>2 min √† pied</strong> ‚Äì pains & viennoiseries 7j/7',
    'location.items.shuttle.title': 'Navette gratuite',
    'location.items.shuttle.text': 'Arr√™t √† <strong>200 m</strong> ‚Äì toutes les 15 min vers les pistes',
    'location.items.store.title': 'Sup√©rette Sherpa',
    'location.items.store.text': '<strong>12 min √† pied</strong> ‚Äì produits locaux & plats traiteur',
    'location.items.center.title': 'Centre station / ESF',
    'location.items.center.text': '<strong>1,4 km</strong> ‚Äì commerces, restaurants, √©coles de ski',
    'location.items.airport.title': 'A√©roport Gen√®ve',
    'location.items.airport.text': '<strong>1h</strong> en voiture ‚Äì transferts possibles',
    'location.items.plateau.title': "Plateau d'Agy",
    'location.items.plateau.text': '<strong>10 km</strong> ‚Äì ski de fond & raquettes',
    'location.mapLink': 'Ouvrir dans Maps ‚Üí',
    'activities.title': 'Que faire aux Carroz ?',
    'activities.subtitle': 'Une station quatre saisons qui comblera sportifs, familles et √©picuriens.',
    'activities.winter.tag': 'Hiver',
    'activities.winter.title': 'Saison hivernale',
    'activities.winter.list': [
      '<li>Ski alpin & snowboard (Grand Massif)</li>',
      "<li>Ski de fond (Plateau d'Agy)</li>",
      '<li>Raquettes en montagne</li>',
      '<li>Patinoire & tra√Æneau</li>',
      '<li>Spa Aquac√Æme</li>',
      '<li>Gastronomie savoyarde</li>',
      '<li>March√©s de No√´l</li>'
    ].join(''),
    'activities.summer.tag': '√ât√©',
    'activities.summer.title': 'Saison estivale',
    'activities.summer.list': [
      '<li>Randonn√©e en altitude</li>',
      '<li>VTT & v√©lo de descente</li>',
      '<li>Parapente & escalade</li>',
      '<li>Piscine & spa</li>',
      '<li>Golf & tennis</li>',
      '<li>March√©s locaux</li>',
      '<li>Yoga face aux montagnes</li>'
    ].join(''),
    'activities.tip.title': 'üí° Astuce locale',
    'activities.tip.text': "R√©servez vos forfaits √† l'avance sur <a href='https://www.grand-massif.com' target='_blank'>grand-massif.com</a> pour √©viter la file d'attente. L'√©t√©, profitez des remont√©es pour acc√©der aux cr√™tes en quelques minutes.",
    'activities.links.all': 'Toutes les activit√©s',
    'activities.links.ski': 'Infos domaine skiable',
    'activities.links.events': 'Agenda & √©v√©nements',
    'contact.title': 'Parlons de votre s√©jour',
    'contact.subtitle': 'Nous r√©pondons sous 2h en journ√©e pour vous aider √† organiser votre venue.',
    'contact.booking.title': 'R√©servation',
    'contact.booking.text': 'V√©rifiez les disponibilit√©s et r√©servez directement via Airbnb.',
    'contact.booking.cta': 'R√©server sur Airbnb',
    'contact.custom.title': 'Demande personnalis√©e',
    'contact.custom.text': "Besoin de conseils ou d'un devis sur mesure ? Envoyez-nous un message.",
    'contact.form.name': 'Nom complet',
    'contact.form.email': 'Email',
    'contact.form.message': 'Votre message',
    'contact.form.submit': 'Envoyer le message',
    'footer.brand': 'Hameau Retrouv√©',
    'footer.tagline': "Chalet d'exception aux Carroz d'Ar√¢ches",
    'footer.nav': 'Navigation',
    'footer.links.home': 'Accueil',
    'footer.links.location': 'Localisation',
    'footer.links.activities': 'Activit√©s',
    'footer.links.contact': 'Contact',
    'footer.info': 'Informations',
    'footer.address': "Les Carroz d'Ar√¢ches<br>Haute-Savoie, 74300",
    'footer.legal': 'Mentions l√©gales',
    'footer.copyright': '&copy; 2025 Hameau Retrouv√©. Tous droits r√©serv√©s.'
  },
  en: {
    'page.title': "Hameau Retrouv√© - Chalet in Les Carroz d'Ar√¢ches",
    'meta.description': "Rent the Hameau Retrouv√© chalet in Les Carroz d'Ar√¢ches. 3 bedrooms, sleeps 8, in the heart of the Grand Massif. Book your mountain stay.",
    'brand.name': 'HAMEAU RETROUV√â',
    'nav.home': 'Home',
    'nav.location': 'Location',
    'nav.activities': 'Activities',
    'nav.book': 'Book now',
    'language.switchLabel': 'Language selection',
    'hero.tag': "Les Carroz d'Ar√¢ches",
    'hero.title': 'Your Hameau Retrouv√© chalet',
    'hero.subtitle': 'A warm cocoon for family and friends, steps from the slopes and village life.',
    'hero.cta': 'Explore the chalet',
    'intro.label': 'Hameau Retrouv√©',
    'intro.title': 'Your private alpine refuge',
    'intro.paragraph1': 'The top floor hosts a 29 m¬≤ living room and kitchen beneath exposed beams, warmed by a new pellet stove and opening onto two south-facing balconies.',
    'intro.paragraph2': 'The chalet offers 80 m¬≤ across three levels, with a 10 m¬≤ terrace, fenced garden, and sweeping views over the Grand Massif peaks.',
    'intro.paragraph3': 'The middle floor features a double bedroom, a twin room, and a bathroom with WC. The garden level adds a second double bedroom with outdoor access, a sofa bed, another bathroom, and a separate WC.',
    'stats.bedrooms': 'Bedrooms',
    'stats.guests': 'Guests',
    'stats.bathrooms': 'Bathrooms',
    'gallery.title': 'Your private alpine refuge',
    'gallery.labels.living': 'Living room',
    'gallery.labels.bedroom': 'Bedroom',
    'gallery.labels.kitchen': 'Kitchen',
    'gallery.labels.dining': 'Dining room',
    'gallery.labels.view': 'Mountain view',
    'gallery.labels.stove': 'Pellet stove',
    'gallery.labels.lounge': 'Lounge area',
    'gallery.labels.bedroom2': 'Bedroom 2',
    'gallery.labels.panorama': 'Panorama',
    'practical.card1.title': 'Prime location',
    'practical.card1.text': 'Artisan bakery, Grand Massif shuttle, and ski rental next door ‚Ä¢ Super U grocery 10 min drive ‚Ä¢ Village center 1.4 km away',
    'practical.card2.title': 'For skiers',
    'practical.card2.text': 'Grand Massif domain ‚Ä¢ Private ski locker ‚Ä¢ Free shuttle to the gondola',
    'practical.card3.title': 'All-inclusive comfort',
    'practical.card3.text': 'Bed linen & towels ‚Ä¢ Beds made on arrival ‚Ä¢ Baby kit ‚Ä¢ Two parking spots',
    'features.title': 'Amenities & Services',
    'features.subtitle': 'Spaces designed for memorable moments in every season.',
    'features.sleep.title': 'Night & bath comfort',
    'features.sleep.desc': '3 quiet bedrooms, hotel-grade bedding, generous storage.',
    'features.sleep.list': [
      '<li>Double bedroom with storage on the middle floor</li>',
      '<li>Twin bedroom (2 single beds) perfect for kids or friends</li>',
      '<li>Garden-level suite: double bedroom + sofa bed</li>',
      '<li>2 bathrooms with bathtubs + 2 WCs including 1 separate</li>',
      '<li>Bed linen provided and beds made for arrival</li>',
      '<li>Baby essentials available (travel cot, high chair)</li>'
    ].join(''),
    'features.dining.title': 'Shared meals',
    'features.dining.desc': 'A fully equipped kitchen ready for every Savoyard feast.',
    'features.dining.list': [
      '<li>29 m¬≤ living room on the top floor</li>',
      '<li>Recent pellet stove and warm timber ambiance</li>',
      '<li>Fitted kitchen: oven, hob, microwave, dishwasher</li>',
      '<li>Two south-facing balconies + 10 m¬≤ terrace and garden</li>',
      '<li>Fondue/raclette sets and dinnerware for 8 guests</li>'
    ].join(''),
    'features.ski.title': 'Ski & outdoor',
    'features.ski.desc': 'Everything ready for long days on the slopes.',
    'features.ski.list': [
      '<li>Private heated and secure ski locker</li>',
      '<li>Two dedicated outdoor parking spots</li>',
      '<li>Free shuttle to the gondola at the end of the lane</li>',
      '<li>Fenced garden for winter play and summer picnics</li>',
      '<li>Direct access to the Grand Massif (265 km of pistes)</li>'
    ].join(''),
    'features.services.title': 'Included services',
    'features.services.desc': 'We handle the details so you can simply enjoy.',
    'features.services.list': [
      '<li>Beds made, full linen set, and welcome products</li>',
      '<li>Dual heating: pellet stove + electric radiators</li>',
      '<li>Electric water heater and ventilation for steady comfort</li>',
      '<li>Utility room for skis, sleds, or bikes</li>',
      '<li>Home rented with everyday essentials</li>'
    ].join(''),
    'booking.title': 'Ready for the experience?',
    'booking.subtitle': 'Check live rates and book in just two minutes.',
    'booking.primary': 'Book on Airbnb',
    'booking.secondary': 'Ask a question',
    'reviews.title': 'What our guests love',
    'reviews.item1.text': '"Stunning chalet, spotless and perfectly located. The bakery downstairs made breakfast a treat. We will be back!"',
    'reviews.item1.author': 'Ginette',
    'reviews.item2.text': '"Feels just like home. Cozy d√©cor, full equipment, and the heated ski room is perfect after a day on the slopes."',
    'reviews.item2.author': 'Jo√´lle',
    'reviews.item3.text': '"Ideal for a big family! Well-equipped kitchen for raclette nights, comfy pellet stove, and super-responsive hosts."',
    'reviews.item3.author': 'Sylvie',
    'location.title': "Les Carroz d'Ar√¢ches",
    'location.lead': 'Authentic village resort, linked to the Grand Massif and just 1 hour from Geneva.',
    'location.items.bakery.title': 'Artisan bakery',
    'location.items.bakery.text': '<strong>2 min walk</strong> ‚Äì fresh bread & pastries daily',
    'location.items.shuttle.title': 'Free shuttle',
    'location.items.shuttle.text': 'Stop <strong>200 m</strong> away ‚Äì every 15 min to the lifts',
    'location.items.store.title': 'Sherpa grocery',
    'location.items.store.text': '<strong>12 min walk</strong> ‚Äì local produce & prepared dishes',
    'location.items.center.title': 'Resort center / ESF',
    'location.items.center.text': '<strong>1.4 km</strong> ‚Äì shops, restaurants, ski schools',
    'location.items.airport.title': 'Geneva airport',
    'location.items.airport.text': '<strong>1 hr</strong> drive ‚Äì transfer options available',
    'location.items.plateau.title': "Plateau d'Agy",
    'location.items.plateau.text': '<strong>10 km</strong> ‚Äì nordic skiing & snowshoeing',
    'location.mapLink': 'Open in Maps ‚Üí',
    'activities.title': 'Things to do in Les Carroz',
    'activities.subtitle': 'A four-season resort for athletes, families, and food lovers.',
    'activities.winter.tag': 'Winter',
    'activities.winter.title': 'Winter season',
    'activities.winter.list': [
      '<li>Alpine skiing & snowboarding (Grand Massif)</li>',
      "<li>Nordic skiing (Plateau d'Agy)</li>",
      '<li>Mountain snowshoeing</li>',
      '<li>Ice rink & sledding</li>',
      '<li>Aquac√Æme spa</li>',
      '<li>Savoyard gastronomy</li>',
      '<li>Christmas markets</li>'
    ].join(''),
    'activities.summer.tag': 'Summer',
    'activities.summer.title': 'Summer season',
    'activities.summer.list': [
      '<li>High-altitude hiking</li>',
      '<li>MTB & downhill biking</li>',
      '<li>Paragliding & climbing</li>',
      '<li>Pool & spa</li>',
      '<li>Golf & tennis</li>',
      '<li>Local markets</li>',
      '<li>Yoga facing the peaks</li>'
    ].join(''),
    'activities.tip.title': 'üí° Local tip',
    'activities.tip.text': "Pre-book your lift passes on <a href='https://www.grand-massif.com' target='_blank'>grand-massif.com</a> to skip the line. In summer, use the lifts to reach the ridges in minutes.",
    'activities.links.all': 'All activities',
    'activities.links.ski': 'Ski area info',
    'activities.links.events': 'Agenda & events',
    'contact.title': "Let's plan your stay",
    'contact.subtitle': 'We reply within 2 hours during the day to help you prepare your trip.',
    'contact.booking.title': 'Booking',
    'contact.booking.text': 'Check availability and book directly via Airbnb.',
    'contact.booking.cta': 'Book on Airbnb',
    'contact.custom.title': 'Tailored request',
    'contact.custom.text': 'Need advice or a custom quote? Send us a message.',
    'contact.form.name': 'Full name',
    'contact.form.email': 'Email',
    'contact.form.message': 'Your message',
    'contact.form.submit': 'Send message',
    'footer.brand': 'Hameau Retrouv√©',
    'footer.tagline': "Exceptional chalet in Les Carroz d'Ar√¢ches",
    'footer.nav': 'Navigation',
    'footer.links.home': 'Home',
    'footer.links.location': 'Location',
    'footer.links.activities': 'Activities',
    'footer.links.contact': 'Contact',
    'footer.info': 'Information',
    'footer.address': "Les Carroz d'Ar√¢ches<br>Haute-Savoie, 74300",
    'footer.legal': 'Legal notice',
    'footer.copyright': '&copy; 2025 Hameau Retrouv√©. All rights reserved.'
  }
};

const DEFAULT_LANG = 'fr';
let currentLang = null;

function applyTranslations(lang) {
  const dict = translations[lang] || translations[DEFAULT_LANG];
  if (!dict) return;

  document.documentElement.setAttribute('lang', lang);

  if (dict['page.title']) {
    document.title = dict['page.title'];
  }

  const metaDescription = document.querySelector('meta[name="description"]');
  if (metaDescription && dict['meta.description']) {
    metaDescription.setAttribute('content', dict['meta.description']);
  }

  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    if (!key) return;
    const value = dict[key];
    if (typeof value === 'undefined') return;
    const attr = element.getAttribute('data-i18n-attr');
    if (attr) {
      element.setAttribute(attr, value);
      return;
    }
    element.innerHTML = value;
  });
}

function setLanguage(lang, options = {}) {
  const { store = true } = options;
  const chosenLang = translations[lang] ? lang : DEFAULT_LANG;
  currentLang = chosenLang;
  applyTranslations(chosenLang);

  document.querySelectorAll('.lang-btn').forEach(button => {
    const isActive = button.getAttribute('data-lang') === chosenLang;
    button.classList.toggle('active', isActive);
    button.setAttribute('aria-pressed', isActive);
  });

  if (store) {
    try {
      localStorage.setItem('preferredLang', chosenLang);
    } catch (error) {
      console.warn('Unable to store language preference', error);
    }
  }
}

function initLanguageSwitcher() {
  const storedLang = (() => {
    try {
      return localStorage.getItem('preferredLang');
    } catch (error) {
      return null;
    }
  })();

  setLanguage(storedLang || DEFAULT_LANG, { store: false });

  document.querySelectorAll('.lang-btn').forEach(button => {
    button.addEventListener('click', () => {
      const newLang = button.getAttribute('data-lang');
      if (newLang && newLang !== currentLang) {
        setLanguage(newLang);
      }
    });
  });
}

// Interaction logic for tab navigation, gallery lightbox, and subtle UI effects.
function showTab(tabId, event) {
  if (event) event.preventDefault();

  document.querySelectorAll('.tab-content').forEach(section => {
    section.classList.remove('active');
  });

  const targetSection = document.getElementById(tabId);
  if (targetSection) {
    targetSection.classList.add('active');
  }

  document.querySelectorAll('.nav-item').forEach(link => {
    link.classList.remove('active');
  });
  if (event && event.target.classList.contains('nav-item')) {
    event.target.classList.add('active');
  }

  const hero = document.querySelector('.hero-fullscreen');
  const nav = document.querySelector('.nav-fixed');
  if (!hero || !nav) return;

  if (tabId === 'accueil') {
    hero.style.display = 'flex';
    document.body.classList.add('hero-visible');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  } else {
    hero.style.display = 'none';
    document.body.classList.remove('hero-visible');
    nav.classList.add('scrolled');
    window.scrollTo({ top: 0, behavior: 'instant' });
  }
}

function initMobileNavHide() {
  const navMenu = document.querySelector('.nav-menu');
  if (!navMenu) return;

  let lastScrollY = window.scrollY;
  let ticking = false;

  const updateMenuVisibility = () => {
    const currentScroll = window.scrollY;
    const isMobile = window.matchMedia('(max-width: 768px)').matches;

    if (!isMobile) {
      navMenu.classList.remove('nav-menu-mobile-hidden');
      lastScrollY = currentScroll;
      ticking = false;
      return;
    }

    const scrollDelta = currentScroll - lastScrollY;

    if (scrollDelta > 8 && currentScroll > 80) {
      navMenu.classList.add('nav-menu-mobile-hidden');
    } else if (scrollDelta < -8 || currentScroll < 50) {
      navMenu.classList.remove('nav-menu-mobile-hidden');
    }

    lastScrollY = currentScroll;
    ticking = false;
  };

  const requestTick = () => {
    if (ticking) return;
    window.requestAnimationFrame(updateMenuVisibility);
    ticking = true;
  };

  window.addEventListener('scroll', requestTick, { passive: true });
  window.addEventListener('resize', () => {
    navMenu.classList.remove('nav-menu-mobile-hidden');
    lastScrollY = window.scrollY;
  });

  updateMenuVisibility();
}

window.addEventListener('scroll', () => {
  const nav = document.querySelector('.nav-fixed');
  if (!nav) return;
  if (window.scrollY > 100) {
    nav.classList.add('scrolled');
  } else {
    nav.classList.remove('scrolled');
  }
});

document.addEventListener('DOMContentLoaded', () => {
  const images = document.querySelectorAll('img');
  const imageObserver = new IntersectionObserver((entries, observer) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const img = entry.target;
        img.classList.add('loaded');
        observer.unobserve(img);
      }
    });
  });

  images.forEach(img => {
    imageObserver.observe(img);
  });

  initMobileNavHide();
  initLanguageSwitcher();
});

const revealElements = document.querySelectorAll('.feature-box, .gallery-img, .activity-modern');
const revealObserver = new IntersectionObserver(entries => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      entry.target.style.opacity = '1';
      entry.target.style.transform = 'translateY(0)';
    }
  });
}, { threshold: 0.1 });

revealElements.forEach(el => {
  el.style.opacity = '0';
  el.style.transform = 'translateY(30px)';
  el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
  revealObserver.observe(el);
});

const galleryButtons = document.querySelectorAll('.gallery-trigger');
const galleryImages = Array.from(document.querySelectorAll('.gallery-img img'));
const lightbox = document.getElementById('lightbox');
const lightboxImage = document.getElementById('lightbox-image');
const lightboxCaption = document.getElementById('lightbox-caption');
const closeLightboxBtn = document.querySelector('.lightbox-close');
const prevBtn = document.querySelector('.lightbox-nav.prev');
const nextBtn = document.querySelector('.lightbox-nav.next');
let currentImageIndex = 0;

function openLightbox(index) {
  currentImageIndex = index;
  const img = galleryImages[index];
  if (!img || !lightbox || !lightboxImage || !lightboxCaption) return;
  lightboxImage.src = img.src;
  lightboxImage.alt = img.alt;
  lightboxCaption.textContent = img.alt;
  lightbox.classList.add('active');
  lightbox.setAttribute('aria-hidden', 'false');
  document.body.style.overflow = 'hidden';
}

function closeLightbox() {
  if (!lightbox) return;
  lightbox.classList.remove('active');
  lightbox.setAttribute('aria-hidden', 'true');
  document.body.style.overflow = '';
}

function showPrevImage() {
  const newIndex = (currentImageIndex - 1 + galleryImages.length) % galleryImages.length;
  openLightbox(newIndex);
}

function showNextImage() {
  const newIndex = (currentImageIndex + 1) % galleryImages.length;
  openLightbox(newIndex);
}

if (
  galleryButtons.length &&
  galleryImages.length &&
  lightbox &&
  lightboxImage &&
  lightboxCaption &&
  closeLightboxBtn &&
  prevBtn &&
  nextBtn
) {
  galleryButtons.forEach(button => {
    button.addEventListener('click', () => {
      const index = Number(button.dataset.index) || 0;
      openLightbox(index);
    });
  });

  closeLightboxBtn.addEventListener('click', closeLightbox);
  prevBtn.addEventListener('click', showPrevImage);
  nextBtn.addEventListener('click', showNextImage);

  lightbox.addEventListener('click', event => {
    if (event.target === lightbox) {
      closeLightbox();
    }
  });

  document.addEventListener('keydown', event => {
    if (!lightbox.classList.contains('active')) return;
    if (event.key === 'Escape') closeLightbox();
    if (event.key === 'ArrowLeft') showPrevImage();
    if (event.key === 'ArrowRight') showNextImage();
  });
}

window.scrollToGallery = event => {
  if (event) event.preventDefault();
  showTab('accueil');
  const gallerySection = document.getElementById('galerie');
  if (gallerySection) {
    const top = gallerySection.getBoundingClientRect().top + window.pageYOffset - 80;
    window.scrollTo({ top, behavior: 'smooth' });
  }
};

window.showTab = showTab;
